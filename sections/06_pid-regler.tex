\section{PID-Regler}

\begin{outline}
    \1 \textbf{P}: Proportional $K_P \cdot e(t)$
        \2 Gegenwart: Gewichtung des \textbf{aktuellen} Fehlers $e(t)$
            \3 Stellgrösse $u(t)$ ist abhängig vom aktuell vorhandenen Fehler
            \3 Wie gross Fehler in Vergangenheit war oder in welche Richtung er sich entwickelt, ist irrelevant
    \1 \textbf{I}: Integral $K_I \int e(t)$
        \2 Vergangenheit: Gewichtung der \textbf{Summe vergangener} Fehler
            \3  Stellgrösse $u(t)$ ist abhängig davon, wie lange ein Fehler schon existiert
            \3 Wie gross der aktuelle Fehler ist und wie start er sich gerade ändert, ist irrelevant
    \1 \textbf{D}: Differential $K_D \cdot \dot{e}(t)$
        \2 Zukunft, Trend: Gewichtung der \textbf{Änderung} des Fehlers
            \3 Stellgrösse ist abhängig davon, wie stark der Fehler gerade zu-/abnimmt
            \3 Wie gros der aktuelle Fehler ist und wie lange er schon existiert, ist irrelevant
\end{outline}


\subsection{Strukturen und Frequenzgänge von PID-Reglern}
\label{Strukturen PID-Regler}

Alle drei Strukturen sind \textbf{äquivalent}. Es handelt sich nur um unterschiedliche Darstellungsformen.


\subsubsection{Varirante 1: Parallelform}

\begin{minipage}[c]{0.4\columnwidth}
    \includegraphics[width=\columnwidth]{images/pid_regler_aufbau.png}
\end{minipage}
\hfill
\begin{minipage}[c]{0.48\columnwidth}
    $$ \boxed{ G_{PID}(\jimg \omega) = K_P + \frac{K_I}{\jimg \omega} + K_D \frac{\jimg \omega}{1 + \jimg \omega T_C} } $$
\end{minipage}


\subsubsection{Variante 2: Standardform (P-Anteil vorangestellt)}

\begin{minipage}[c]{0.4\columnwidth}
    \includegraphics[width=\columnwidth]{images/pid_regler_aufbau_standardform.png}
\end{minipage}
\hfill
\begin{minipage}[c]{0.55\columnwidth}
    $$ \boxed{ G_{PID}(\jimg \omega) = K_R + \Big( 1 + \frac{1}{\jimg \omega T_N} +\frac{\jimg \omega T_V}{1 + \jimg \omega T_C} \Big) } $$
\end{minipage}


\subsubsection{Variante 3: Serielle (multiplikative) Form}

    \includegraphics[width=0.8\columnwidth]{images/pid_regler_aufbau_serielle_form.png}
    $$ \boxed{ G_{PID}(\jimg \omega) = \tilde{K}_R \cdot \Big( 1 + \frac{1}{\jimg \omega \tilde{T}_N} \Big) \cdot \Big(1 + \frac{\jimg \omega \tilde{T}_V}{1 + \jimg \omega T_C} \Big) } $$

\subsubsection{Umrechnung Parameter Variante 1 -- Variante 2}

\begin{tabular}{c c c c c c c c c}
    $K_R = K_P$ & & $T_N = \frac{K_P}{K_I}$ & & $T_V = \frac{K_D}{K_P}$ & & $K_I = \frac{K_R}{T_N}$ & & $ K_D = K_R T_V$
\end{tabular}

\subsubsection{Umrechnung Parameter Variante 2 -- Variante 3}

\begin{tabular}{c c c c c}
    $K_R = \tilde{K}_R \Big( 1 + \frac{\tilde{T}_V}{\tilde{T}_N} \Big)$ & &
    $T_N = \tilde{T}_N + \tilde{T}_V$ & &
    $T_V = \tilde{T}_V \frac{\tilde{T}_N - \tilde{T}_C}{\tilde{T}_N + \tilde{T}_V}$ 
\end{tabular}

\subsection{Matlab / Simulink}

\begin{minipage}[t]{0.45\columnwidth}
    \subsubsection*{Matlab}

    \begin{outline}
        \1 Parallelform
            \2 \mylstbox{C = pid(Kp, Ki, Kd, Tf)}
            \2 $C = K_p + \frac{K_i}{s} + \frac{K_d \cdot s}{T_f \cdot s + 1}$
        \1 Standardform
            \2 \mylstbox{C = pidstd(Kp, Ti, Td, N)}
            \2 $C = K_p \Big( 1 + \frac{1}{T_i \cdot s} + \frac{T_d \cdot s}{\frac{T_d}{N} s + 1} \Big)$
            \2 $T_f = \frac{T_d}{N}$
    \end{outline}
\end{minipage}
\hfill
\begin{minipage}[t]{0.53\columnwidth}
    \subsubsection*{Simulink}

    \begin{outline}
        \1 Parallelform
        \2 $P + I \frac{1}{s} + D \frac{N}{1 + N \frac{1}{s}}$
        \2 $D \frac{N}{1 + N \frac{1}{s}} = \frac{D \cdot s}{\frac{1}{N} s + 1}$
        \2 $P = K_P$, $I = K_I$, $D = K_D$, $N = \frac{1}{T_C}$
    \1 Standardform ('ideal')
        \2 $P \cdot \Big( 1 + I \frac{1}{s} + D \frac{N}{1 + N \frac{1}{s}} \Big)$
        \2 $D \frac{N}{1 + N \frac{1}{s}} = \frac{D \cdot s}{\frac{1}{N} s + 1}$
        \2 $P = K_R$, $I = \frac{1}{T_N}$, $D = T_V$, $N = \frac{1}{T_C}$
    \end{outline}
\end{minipage}


\subsection{PID-Regler im Frequenzgang}

\begin{outline}
    \1 \textbf{P}: Proportional $K_P$
        \2 Frequenz\textbf{un}abhängige Gewichtung
        \2 Allpassverhalten (alle Frequenzen gleich verstärkt)
    \1 \textbf{I}: Integral $K_I \frac{1}{\jimg \omega}$
        \2 Gewichtet tiefe Frequenzen stärker als hohe Frequenzen
        \2 Reagiert auf 'langsame' Änderungen 
        \2 Tiefpassverhalten; Phasenschiebung: $-90 \degree$ (im Uhrzeigersinn)
    \1 \textbf{D}: Differential $K_D \jimg \omega$
        \2 Gewichtet hohe Frequenzen stärker als tiefe Frequenzen
        \2 Reagiert auf 'schnelle' Änderungen 
        \2 Hochpassverhalten; Phasenschiebung: $+90 \degree$ (gegen Uhrzeigersinn)
\end{outline}


\subsection{PID-Regler im Bodediagramm}

\textbf{Achtung:} Gemäss den Frequenzgängen der verschiedenen Darstellungsformen aus Abschnitt ~\ref{Strukturen PID-Regler} 
eines PID-Reglers darf im Bodediagramm \textbf{nur Variante 3 grafisch aus den Einzelteilen addiert} werden. 


\subsection{Fallstudie: Gleichstromantrieb -- Modellierung}{53}
\begin{center}
    \includegraphics[width=0.75\columnwidth]{images/vereinfachtes_modell_gleichstromantrieb.png} 
\end{center}
Der Gleichstromantrieb kann als $\text{PT}_1$-Glied mit zwei Eingängen $u(t)$ und $M_L(t)$ modelliert werden. $M_L(t)$ entspricht
einer durch Wirbelströme erzeugte \textbf{Störung}.
$$ \boxed{ \underbrace{\frac{R \cdot J}{\Psi^2}}_{T} \dot{y}(t) + y(t) = \underbrace{\frac{K_P \cdot K_{\omega}}{\Psi}}_{K_1} u(t)
    - \underbrace{\frac{R \cdot K_{\omega}}{\Psi^2}}_{K_2} M_L(t) } $$


\subsubsection{Parameter-Identifikation}

\begin{minipage}[c]{0.48\columnwidth}
    \includegraphics[width=\columnwidth]{images/gleichstrommodell_parameteridentifikation.png}
\end{minipage}
\hfill
\begin{minipage}[c]{0.48\columnwidth}
    Aus der \textbf{Sprungantwort} können einige Parameter abgelesen werden. Einige weitere Parameter sind aus Datenblättern bekannt.
    \includegraphics[width=\columnwidth]{images/gleichstrommodell_parameter.png}
    $M_{L1} = 4.8 \cdot 10^{-2} \, [\newton \meter]$
    
\end{minipage}


\subsection{Gleichstromantrieb mit Steuerung}{148-149}

Die Grösse $\omega$ soll im \textbf{steady-state} gesteuert werden \textrightarrow\ Ableitungen 0, keine Störungen \\
Zu steuern: $\omega = 25 \cdot 2 \pi$, $K_{\omega} \cdot \omega = y = 3.77 \, \volt$ \textrightarrow\ Finde Wert der Eingangsgrösse $u(t)$
$$ \boxed{ \text{Im steady-state: } \xcancel{ \underbrace{\frac{R \cdot J}{\Psi^2}}_{T} \dot{y}(t) } + y_{stat}(t) = \underbrace{\frac{K_P \cdot K_{\omega}}{\Psi}}_{K_1} u(t)
    -  \xcancel{ \underbrace{\frac{R \cdot K_{\omega}}{\Psi^2}}_{K_2} M_L(t) } }$$

$$ y_{stat} = \frac{K_P \cdot K_{\omega}}{\Psi} u_{stat}(t) \qquad  \underrightarrow{y_{stat} = K_{\omega} \cdot \omega } \qquad 
    \omega_{stat} = \frac{K_p}{\Psi} u_{stat}  $$
$$ \text{\textrightarrow\ } u_{stat} = \frac{\Psi}{K_P} \omega_{stat}  = \frac{\Psi}{K_P} 25 \cdot 2 \pi = 4.14 \, \volt \quad  $$


\subsubsection{Probleme der Steuerung}

\begin{minipage}[c]{0.4\columnwidth}
    \includegraphics[width=\columnwidth]{images/gleichstromantrieb_steuerung_step-response.png}
\end{minipage}
\hfill
\begin{minipage}[c]{0.48\columnwidth}
    \begin{itemize}
        \item Endwert wird zwar erreicht, aber wenn $K_P$ oder $\Psi$ variieren wird dies nicht mehr der Fall sein
        \item Die Drehzahländerung ist 'langsam' (gemäss Zeitkonstante $T$). (Ein höheres $u$ zu Beginn könnte $T$ verkürzen)
        \item \textbf{Die Steuerung reagiert nicht auf die Störungen!}
    \end{itemize}
\end{minipage}


\subsection{Gleichstromantrieb mit P-Regler}{149-150}

\begin{minipage}[c]{0.4\columnwidth}
    \includegraphics[width=\columnwidth]{images/gleichstromantrieb_p-regler.png}
\end{minipage}
\hfill
\begin{minipage}[c]{0.48\columnwidth}
    $$ u(t) = K_R \cdot e(t) = K_R \cdot ( r(t) - y(t) )$$
\end{minipage}

$$ \boxed{ \text{Geschlossener Regelkreis: } \underbrace{\frac{T}{1 + K_1 K_R}}_{T_f} \dot{y}(t) + y(t) = \underbrace{\frac{K_1 K_R}{1 + K_1 K_R}}_{K_f} u(t)
    - \underbrace{\frac{K_2}{1 + K_1 K_R}}_{K_z} M_L(t) } $$

Damit der Sollwert $r(t)$ erreicht wird (wenn keine Störung $M_L(t)$ vorhanden ist), muss $K_F = 1$ sein
\textrightarrow\ $K_R$ muss sehr gross sein


\subsubsection{Eigenschaften des P-Reglers}


\begin{minipage}[c]{0.4\columnwidth}
    \includegraphics[width=\columnwidth]{images/gleichstromantrieb_p-regler_step-response.png}
\end{minipage}
\hfill
\begin{minipage}[c]{0.58\columnwidth}
    \begin{itemize}
        \item Für $K_R \to \infty$ werden die Zeitkonstante $T_f$ und der Einfluss der Störung $M_L(t)$ beliebig klein \\
            \textrightarrow\ DGL konvergiert zu $y(t) = r(t)$
        \item Für kleine $K_R$ wird Endwert nicht erreicht \\
            \textrightarrow\ statischer Fehler
        \item Stellgrösse $u(t)$ sättigt aufgrund von physikalischen Gegebenheiten \textrightarrow\ Prozess wird \textbf{nichtlinear}
            \textrightarrow\ Überschwinger
        \item Messrauschen wird ebenfalls verstärkt (P-Regler verstärt \textbf{alle} Frequenzen) 
    \end{itemize}
\end{minipage}

\textrightarrow\ \textbf{Es bleibt ein stationärer Fehler!} Dafür reagiert der P-Regler schnell.


% TODO ab hier
\subsection{Gleichstromantrieb mit I-Regler}{151-152}


\subsection{Gleichstromantrieb mit PI-Regler}{152-154}


\subsection{Gleichstromantrieb mit PID-Regler}{155}


\subsection{Gleichstromantrieb mit Totzeit mit PI-Regler}{157-159}


\subsection{Gleichstromantrieb mit Totzeit mit PID-Regler}{160-162}